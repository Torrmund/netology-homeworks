# Домашнее задание к занятию "Teamcity"

## Подготовка к выполнению

|                                                                                                      Номер и описание задачи                                                                                                      | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Скриншоты                                                                                                                                     |
| :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                                         1. В YC создать новый инстанс на<br />основе образа teamcity-server                                                                         | Для поднятия инстанса использовал<br />контейнеризацию в YC и написал<br />простой compose для поднятия teamcity-server<br />и postgres для него.<br />Т.к. в образе jetbrains/teamcity-server по умолчанию<br />нет драйвера jdbc и потому как это тестовое окружение,<br />решил не создавать свой образ на базе указанного, а <br />просто добавить в compose файл контейнер, который<br />будет скачивать драйвер jdbc и складывать его в <br />волюм контейнера teamcity-server.<br />Таким образом, поднялся контейнер с<br />teamcity-server и выполнилось его подключение к <br />свой базе postgresql. | ![1736161437008](image/README/1736161437008.png)<br />![1736164006815](image/README/1736164006815.png)                                                     |
|                                                          2. Дождаться запуска teamcity-server<br />Выполнить первоначальную <br />настройку                                                          | Подождал, пока teamcity server запустится.<br />Выполнил первоначальную настройку.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ![1736163646157](image/README/1736163646157.png)<br />![1736163770747](image/README/1736163770747.png)                                                     |
| 3. Создать еще один инстанс на<br />основе образа<br />jetbrains/teamcity-agent.<br />Прописать переменную окружения<br />для подключения агента к серверу | Для поднятия инстанса использовал контейнеризацию<br />в YC и написал простой compose для поднятия<br />teamcity-agent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ![1736164926712](image/README/1736164926712.png)<br />![1736164958609](image/README/1736164958609.png)                                                     |
|                                                                                                        4. Авторизовать агент                                                                                                        | После поднятия агента, он отобразился в списке<br />неавторизованных агентов на сервере teamcity.<br />Авторизовал агент.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ![1736165044062](image/README/1736165044062.png)<br />![1736165079404](image/README/1736165079404.png)<br />![1736165107195](image/README/1736165107195.png) |
|                                                                                                      5. Форкнуть[репозиторий]()                                                                                                      | Форкнул репозиторий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ![1736165211777](image/README/1736165211777.png)                                                                                                         |
|                    6. Создать еще одну VM и<br />поднять на ней Nexus при помощи<br />[playbook](https://github.com/netology-code/mnt-homeworks/tree/MNT-video/09-ci-05-teamcity/infrastructure)                    | Создал VM.<br />Запустил playbook для этой VM.<br />Дождался запуска Nexus                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ![1736165552006](image/README/1736165552006.png)<br />![1736167326832](image/README/1736167326832.png)<br />![1736167344492](image/README/1736167344492.png) |

## Основная часть

|                                                                                      Номер и описание задачи                                                                                      | Описание выполняемых действийй                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Скриншоты                                                                                 |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
|                                                                        1. Создать новый проект на основе форка                                                                        | Создан новый проект на основе<br />сделанного ранее форка                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ![1736167547550](image/README/1736167547550.png)<br />![1736167573453](image/README/1736167573453.png) |
|                                                                 2. Выполнить автодетект конфигурации<br />сборки                                                                 | Автодетект выполнился автоматически                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ![1736167688174](image/README/1736167688174.png)                                                     |
|                                                3. Сохранить необходимые шаги<br />и запустить первую сборку на master.                                                | Сохранен единственный имеющийся шаг.<br />Через кнопку run запустил первую сборку<br />для master ветки                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ![1736167828091](image/README/1736167828091.png)                                                     |
|         4. Поменять условия сборки:<br />Если сборка по ветке master, то должен<br />происходить mvn clean deploy, иначе <br />mvn clean test.         | Создал отдельный Build Step с названием<br />Deploy.<br />В конфигурации прописал раннер maven и <br />команду clean deploy, а также условие запуска<br />если ветка master. Прикрепил файл settings.xml<br /><br />Изменил добавленный по умолчанию шаг<br />maven на build and test. <br />Действие осталось по умолчанию - <br />mvn clean test.<br />Условия срабатывания<br />данного шага указаны таким образом, что <br />данный шаг выполняется всегда и для любой<br />ветки.<br /><br />Таким образом, для всех веток будет выполняться<br />тестирование, а для ветки master, дополнительно,<br />будет также выполняться шаг deploy. | ![1736171767487](image/README/1736171767487.png)<br />![1736173177393](image/README/1736173177393.png) |
|                                                                                   5. Для deploy загрузить settings.xml                                                                                   | В Nexus создал отдельного пользователя<br />teamcity.<br />Занес креды этого пользователя в settings.xml<br />Загрузил файл settings.xml в teamcity.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ![1736171435312](image/README/1736171435312.png)<br />![1736171517475](image/README/1736171517475.png) |
|                                                       6. В pom.xml форкнутого репозитория<br />заменить ссылку на nexus.                                                       | Заменил ссылку на nexus на свой развернутый.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                    |
|                   7. Запустить сборку по master ветке.<br />Убедиться, что все прошло успешно<br />и артефакт появился в nexus.                   | Т.к. в конфигурации указано, что teamcity сканирует<br />репозиторий каждую минуту, то после пуша изменений<br />в master, teamcity самостоятельно запустил сборку и <br />выложил артефакт в nexus.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ![1736173576796](image/README/1736173576796.png)<br />![1736173587381](image/README/1736173587381.png) |
|                                                                      8. Мигрируйте build configuration<br />в репозиторий.                                                                      | Экспортировал конфигурацию и поместил в<br />директорию .teamcity репозитория.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ![1736177337535](image/README/1736177337535.png)<br />![1736180567768](image/README/1736180567768.png) |
|                                                           9. Создать отдельную ветку<br />feature/add_reply в репозитории                                                           | Создал указанную ветку.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ![1736180784139](image/README/1736180784139.png)                                                     |
| 10. Написать новый метод для класса<br />Welcomer: метод должен возвращать<br />произвольную реплику, содрежащую<br />слово hunter. | Добавил метод                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ![1736182734848](image/README/1736182734848.png)                                                     |
|                                          11. Дописать тест для нового метода на<br />поиск слова hunter в новой реплике                                          | Добавил тест в уже имеющийся, который проверяет<br />наличие слова hunter в определенных репликах.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ![1736182755565](image/README/1736182755565.png)                                                     |
|                                                                  12. Сделать push всех изменений в новую<br />ветку.                                                                  | Запушил изменения в новую ветку                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                    |
|                                    13. Убедиться, что сборка самостоятельно<br />запустилась и тесты прошли успешно.                                    | Сборка запустилась самостоятельно после пуша<br />изменений.<br />Тесты прошли успешно.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ![1736182958213](image/README/1736182958213.png)                                                     |
|                                                             14. Слить изменения из новой ветки в<br />master через merge.                                                             | Дополнительно скорректировал версию артефакта.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ![1736183768955](image/README/1736183768955.png)                                                     |
|                                       15. Настройте конфигурацию так, чтобы<br />она собирала .jar в артефакты сборки.                                       | Внес изменения в конфигурацию                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ![1736184728262](image/README/1736184728262.png)                                                     |
|               16. Провести повторную сборку мастера.<br />Убедиться, что сборка прошла успешно<br />и артефакты собраны.               | Сборка прошла успешно.<br />Артефакты загружены как в nexus, <br />так и в веб интерфейсе                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ![1736184829923](image/README/1736184829923.png)<br />![1736184848354](image/README/1736184848354.png) |
|                                                                            17. Приложить ссылку на репозиторий                                                                            | [Ссылка](https://github.com/Torrmund/example-teamcity)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                    |
