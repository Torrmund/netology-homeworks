# Домашнее задание к занятию "Системы мониторинга"

|                                                                                                                                                                                                                                                                                                                                                                   Вопрос                                                                                                                                                                                                                                                                                                                                                                   | Ответ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1. Вас пригласили настроить мониторинг на проект.<br />На онбординге вам рассказали, что проект представляет из себя <br />платформу для вычислений с выдачей текстовых отчетов, <br />которые сохраняются на диск. <br />Взаимодействие с платформой осуществляется по протоколу http. <br />Также вам отметили, что вычисления загружают ЦПУ. <br />Какой минимальный набор метрик вы выведите в мониторинг <br />и почему? | Минимальны набор метрик:<br />- Загрузка CPU (LA)<br />- RAM/SWAP Usage<br />- Response Time<br />- Request Time<br />- Error Rate<br />- Disk I/O (сюда же относится и inodes)<br /><br />Пояснения:<br />- Потому как вычисления загружают CPU, необходимо<br />отслеживать его загрузку, чтобы отслеживать возможность выполнения<br />запросов системой в реальном времени. Если CPU будет перегружен, <br />то система не сможет обрабатывать запросы, либо будет это делать с ощутимыми<br />задержками.<br />- Вычисления могут потреблять большое количество оперативной памяти.<br />Особенно, если будет обрабатываться большой объем данных. Мониторинг<br />использования оперативной памяти поможет избежать проблем с производитель<br />ностью и/или утечками памяти<br />- Необходимо мониторить время обработки запросов и выдачи отчетов, потому<br />как это критично для пользовательского опыта. Долгое время отклика может <br />указывать на проблемы с производительностью<br />- Также нужно отслеживать количество входящих запросов. Это поможет понять <br />нагрузку на систему, что полезно для проработки масштабирования.<br />- Мониторинг количества ошибок, возникающих при использовании платформы, <br />позволит быстро реагировать на возникающие проблемы и поддерживать<br />стабильность сервиса.<br />- Т.к. отчеты сохраняются на диск, то нужен также и мониторинг операций <br />ввода-вывода и inodes, чтобы отслеживать состояние хранилища и выявлять <br />узкие места, связанные с записью и чтением данных. |
|                                                                                                                       2. Менеджер продукта посмотрев на ваши метрики сказал,<br />что ему непонятно что такое RAM/inodes/CPUla. <br />Также он сказал, что хочет понимать, <br />насколько мы выполняем свои обязанности <br />перед клиентами <br />и какое качество обслуживания. <br />Что вы можете ему предложить?                                                                                                                       | В первую очередь следует объяснить продакту что значит та или иная метрика,<br />а также зафиксировать описание метрик во внутренней документации команды,<br />чтобы всегда можно было сослаться на это описание.<br /><br />Также следует предложить продакту вывести SLI на основе предложенных метрик.<br />Например, связанный с временем отклика, где 95% запросов должны обрабатываться<br />менее чем за 300 мс. Или, например, SLO установлен как - сервис должен выдвать ответы 2хх/3хх в 99% случаев<br />где 1% закладывается на тех. обслуживание и нужно сверить это с фактическим SLI.<br /><br />Для формирования прозрачности, следует также применить визуализацию данных.<br />Например, можно создать дашборд с ключевыми метриками и SLI, который будет наглядно<br />демонстрировать состояние системы и качество обслуживания. Это также поможет продакту <br />лучше понимать, Как связаны метрики и клиентский опыт.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                             3. Вашей DevOps команде в этом году не выделили финансирование<br />на построение системы сбора логов. <br />Разработчики в свою очередь хотят видеть все ошибки, <br />которые выдают их приложения. <br />Какое решение вы можете предпринять в этой ситуации, <br />чтобы разработчики получали ошибки приложения?                                                                                             | Во первых, следует удостовериться, что логирование для приложений настроено со стороны разработчиков.<br />Многие языки программирования и фрейморки имеют встроенные библиотеки для логирования, которые <br />могут сохранять логи в файлы или выводить их в консоль. Следует убедиться, что эти инструменты применяются<br />разработчиками и логи от самих приложений куда-то выводятся. В данном случае лучше, чтобы логи сохранялись<br />в файлы.<br /><br />Затем можно при помощи black-box мониторинга настроить уведомления команде разработки при наступлении <br />недоступности сервиса, что сервер недоступен и нужно посмотреть логи сервиса.<br /><br />В качетсве альтернативы можно применить скриптовое решение, которое будет периодически собирать логи из <br />файлов и отправлять их команде разработки в удобном формате.<br /><br />Если же бюджет не выделен именно на преобретение ПО, то можно исследовать возможность внедрения <br />open-source решений, таких как ELK Stack или Graylog, но при условии, что на работы по внедрению бюджет<br />все же будет выделен.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                               4. Вы, как опытный SRE, сделали мониторинг,<br />куда вывели отображения выполнения SLA=99% по http кодам ответов. <br />Вычисляете этот параметр по следующей формуле: <br />summ_2xx_requests/summ_all_requests. <br />Данный параметр не поднимается выше 70%, <br />но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?                                                                                               | Ошибка заключается в том, что при подсчете учитываются только ответы 2xx, когда от системы могут поступать<br />другие ответы, отличные от 5хх и 4хх, например 3xx, которые также не являются кодами ошибок.<br /><br />Соответственно, следует скорректировать формулу вычисления параметра, чтобы она учитывала все <br />"неошибочные" коды.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                  5. Опишите основные плюсы и минусы pull и push систем мониторинга.                                                                                                                                                                                                                                                                                                                  | Плюсы и минусы Pull систем мониторинга:<br />"+":<br />- Легче контролировать целостность данных;<br />- Можно настроить единый прокси до всех агентов с TLS;<br />- Упрощенная отладка получения данных с агентов;<br />"-":<br />- Данные собираются только в момент запроса, что может привести к задержкам в обнаружении проблем.<br />- Если система не запрашивает данные часто, критические события могут получены с опозданием.<br /><br />Плюсы и минусы Push систем мониторинга:<br />"+":<br />- Упрощение репликации данных в разные системы мониторинга или их резервные копии<br />- Более гибкая настройка пакетов данных с метриками при отправке<br />- Как правило, работают на UDP, а значит производительность выше.<br />"-":<br />- Требует настройки каждого агента<br />- Если нет буфферизации, то данные могут быть потерены, если система будет недоступна<br />- Постоянная частая отправка данных может привести к значительному увеличению нагрузки на сеть.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                                                                                                                                                           6. Какие из перечисленных систем относятся к push модели, а какие<br />к pull ? А может есть гибридные ?<br />- Prometheus<br />- TICK<br />- Zabbix<br />- VictoriaMetrics<br />- Nagios                                                                                                                                                                                                                                           | - Prometheus, как правило, работает по pull модели. Но есть еще PushGateway, но с него все равно prometheus<br />пулит метрики.<br />- TICK - использует push модель в которой Telegraph пушит метрики<br />- Zabbix - может использовать как pull так и push модель<br />- VictoriaMetrics - Может использовать и комбинировать push и pull модели<br />- nagios - не знаком с данным инструментом, но на сколько я понял, он использует pull модель, опрашивая <br />целевые системы для получения их статуса по snmp.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

|                                                                                                                                                                                                                                                                                               Номер и описание задачи                                                                                                                                                                                                                                                                                               | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                  | Скриншоты                                                                                                                                                                                         |
| :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                                                                                                                                                                       7. Склонировать[репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустить<br />TICK-стэк, используя docker и docker compose.                                                                                                                                                                                                                       | Создал новую ВМ в YC<br />Установил в нее Docker<br />Склонировал репозиторий<br />Скорректировал файл docker-compose.yml<br />и запустил docker compose                                                                                                                                                                                                      | ![1736347524235](image/README/1736347524235.png)<br />![1736347771696](image/README/1736347771696.png)<br />![1736347836012](image/README/1736347836012.png)<br />![1736348212072](image/README/1736348212072.png) |
|                                                                                                                                                                                                                                                                           Приложить скриншот веб-интерфейса<br />ПО chronograf                                                                                                                                                                                                                                                                           | Зашел на поднятый chronograf<br />Приложил скрин                                                                                                                                                                                                                                                                                                                                                              | ![1736352083745](image/README/1736352083745.png)                                                                                                                                                             |
| 8. Открыть вкладку Data Explorer<br />- Нажать кнопку Add a query<br />- Изучить вывод интерфейса и выбрать БД<br />telegraf.autogen<br />- В measurments выбрать<br />cpu->host->telegraf->getting-started<br />а в fields выбрать usage_system. Внизу<br />появится график использования CPU.<br />- Вверху будет запрос, похожий на SQL.<br />Поэксперементировать с запросом, изменив<br />группировку и интервал наблюдений. | Открыл вкладку Data Explorer<br />Выбрал то, что указано в задаче.<br />поигрался с запросом.                                                                                                                                                                                                                                                                                     | ![1736352511172](image/README/1736352511172.png)<br />![1736352551022](image/README/1736352551022.png)<br />![1736352567174](image/README/1736352567174.png)<br />![1736352582830](image/README/1736352582830.png) |
|                                                                                                                                                                                                          9. Добавить в telegraf плагин docker<br />При необходимости скорректировать <br />docker-compose.yml<br />Приложить скриншот новых метрик.                                                                                                                                                                                                          | Плагин Docker был в подключен в репозитории<br />по умолчанию, поэтому подключать его отдельно<br />не потребовалось.<br />Проверил на всякий случай конфигурацию,<br />затем пошел в веб интерфейс смотреть метрики.<br />Приложил скриншоты метрик. | ![1736352838472](image/README/1736352838472.png)<br />![1736352925939](image/README/1736352925939.png)<br />![1736352997102](image/README/1736352997102.png)                                                     |
