# Домашнее задание к занятию "Использование Terraform в команде"

## Задание 1

|                                                    Номер и описание задачи                                                    | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Скриншоты                                                                                                                                                                                                                                                                                                 |
| :-----------------------------------------------------------------------------------------------------------------------------------------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Проверить свой код<br />и демонстрационный код<br />из ДЗ №4 с помощью<br />tflint и checkov | Инструменты для проверки запускались через<br />docker.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ![1733167779368](image/README/1733167779368.png)<br />![1733168117763](image/README/1733168117763.png)<br />![1733168136862](image/README/1733168136862.png)<br />![1733168171399](image/README/1733168171399.png)<br />![1733168186534](image/README/1733168186534.png)<br />![1733168200887](image/README/1733168200887.png) |
|                                  2. Перечислить типы обнаруженных<br />ошибок.                                  | tflint:<br />1. Указана ссылка на main ветку модулей, <br />вместо конкретной версии.<br />2. Не указана конкретная версия провайдера<br />template<br />3. Не указана конкретная версия провайдера<br />yandex<br />4. Переменная vms_ssh_root_key объявлена,<br />но не используется<br /><br />Chekov:<br />1. Много строк кода в описании параметров<br />вызываемых модулей<br />2. Версия модулей не ссылается на хеш коммита<br />3. Версия модулей не ссылается на тэг. |                                                                                                                                                                                                                                                                                                                    |

## Задание 2

|                                                                                                                                  Номер и описание задачи                                                                                                                                  | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Скриншоты                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Взять свой код из ДЗ №4<br />и повторить демонстрацию из<br />лекции: настроить YDB, S3 bucket,<br />yandex service account, права доступа и<br />мигрировать state проекта в S3 с<br />блокировками. | Создан S3 bucket под хранение state.<br /><br />Создан сервисный аккаунт. <br />Добавлен ключ для него.<br />Выданы права на бакет.<br /><br />Создана новая БД YDB.<br />Выданы права к ней сервисному <br />аккаунту.<br />Создана новая таблица с <br />нужным полем и типом.<br /><br />Добавлено описание backend-a<br />в код.<br /><br />Т.к. данный проект был ранее запущен<br />без описания s3 backend-a, то стейт<br />хранился локально.<br />Вызываем terraform init с флагом<br />-reconfigure для применения изменений<br />в backend-е. | ![1733169914230](image/README/1733169914230.png)<br />![1733170654995](image/README/1733170654995.png)<br />![1733170892179](image/README/1733170892179.png)<br />![1733172140733](image/README/1733172140733.png)<br />![1733172353160](image/README/1733172353160.png)<br />![1733172610695](image/README/1733172610695.png)<br />![1733172780109](image/README/1733172780109.png)<br />![1733173300303](image/README/1733173300303.png)<br />![1733173275453](image/README/1733173275453.png)<br />![1733173325009](image/README/1733173325009.png)<br />![1733173421649](image/README/1733173421649.png)<br />![1733173425971](image/README/1733173425971.png) |
|                                                                                                          2. Закоммитить в отдельную ветку<br />все изменения.                                                                                                          | Изменения запушены в ветку                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                   3. Открыть в проекте terraform console,<br />а в другом окне из этой же директории<br />запустить terraform apply.                                                                   | Выполнена комманда terraform console<br />из двух вкладок терминала в одной и <br />той же директории.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ![1733173763565](image/README/1733173763565.png)<br />![1733173793453](image/README/1733173793453.png)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                                                       4. Зафиксировать ошибку доступа к<br />state в виде скрина                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ![1733173793453](image/README/1733173793453.png)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                       5. Принудительно разблокировать state.                                                                                                                       | Для принудительной разблокировки стейта<br />выполнена команда<br />terraform force-unlock IDБлокировки                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ![1733173965206](image/README/1733173965206.png)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
