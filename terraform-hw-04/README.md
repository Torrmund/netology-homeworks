# Домашнее задание к занятию "Продвинутые методы работы с Terraform"

## Задание 1

|                                                                                                                                                                                                     Номер и описание задачи                                                                                                                                                                                                     | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                          | Скриншоты                                                                                                                                                                                         |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1. Взять код из демонстрации<br />для создания двух ВМ, относящихся к разным<br />проектам (marketing и analytics).<br />Использовать labels для обозначения<br />принадлежности.<br />В файл cloud-init.yml необходимо использовать<br />переменную ssh ключа вместо хардкода.  | В main.tf добавлен вызов remote<br />модулей.<br />Добавлены все необходимые переменные.<br />Инициализирован проект.<br />Проект запущен.                                                                                                                                                                                | ![1730828844553](image/README/1730828844553.png)<br />![1730828862390](image/README/1730828862390.png)<br />![1730828876176](image/README/1730828876176.png)<br />![1730828900327](image/README/1730828900327.png) |
|                                                                                                                                                                                    2. Добавить в файл cloud-init.yml<br />установку nginx.                                                                                                                                                                                    | В файл cloud-init.yml добавлена установка nginx.<br />Т.к. cloud-init применяется только <br />при создании ВМ,<br /><br />То и перед применением обновленного<br />кода, нужно предварительно удалить<br />ранее созданные ВМ.<br /><br />Что и было сделано. | ![1730830820972](image/README/1730830820972.png)                                                                                                                                                             |
|                                                                                  3. Предоставить скриншоты подключения<br />к созданным ВМ и вывод команды<br />sudo nginx -t<br />А также консоли YC с метками<br />и Terraform Console с содержимым<br />модуля.                                                                                  | Прикреплены скриншоты                                                                                                                                                                                                                                                                                                                                                                         | ![1730831070128](image/README/1730831070128.png)<br />![1730831558259](image/README/1730831558259.png)<br />![1730831579202](image/README/1730831579202.png)<br />![1730831649301](image/README/1730831649301.png) |

## Задание 2

|                                                                                                                               Номер и описание задачи                                                                                                                               | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                | Скриншоты                                                                                                                                                                                                                                             |
| :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|     1. Написать локальный модуль<br />vpc, который будет создавать 2 ресурса:<br />Одну сеть и одну подсеть в зоне,<br />объявленной при вызове модуля,<br />например: ru-central1-a.     | Добавил локальный модуль<br />согласно заданию.                                                                                                                                                                                                                                                                                    | ![1730837937651](image/README/1730837937651.png)<br />![1730837956765](image/README/1730837956765.png)<br />![1730838342875](image/README/1730838342875.png)<br />![1730837984332](image/README/1730837984332.png)<br />![1730838000828](image/README/1730838000828.png) |
|                                                                              2. Вы должны передать в модуль<br />переменные с названием сети, zone и <br />v4_cidr_blocks                                                                              | Добавил вызов модуля vpc<br />в root модуль                                                                                                                                                                                                                                                                                                    | ![1730838393081](image/README/1730838393081.png)                                                                                                                                                                                                                 |
|                 3. Модуль должен возвращать<br />в root module с помощью output<br />информацию о yandex_vpc_subnet.<br />Прикрепить скриншот информации<br />из terraform console о своем модуле.                 | Реализовал через outputs<br />возвращение информации о<br />yandex_vpc_subnet                                                                                                                                                                                                                                                      | ![1730838464555](image/README/1730838464555.png)<br />![1730838478812](image/README/1730838478812.png)                                                                                                                                                             |
| 4. Заменить ресурсы yandex_vpc_network<br />и yandex_vpc_subnet созданным модулем.<br />Не забыть передать необходимые параметры<br />сети из модуля vpc в модуль с виртуальной<br />машиной. | Заменил ресурсы на вызов модуля.<br />Добавил передачу необходимых<br />параметров из модуля vpc в модуль<br />создания ВМ.<br />Инициализировал проект <br />для добавления локального модуля.<br />Выполнил код. | ![1730838581537](image/README/1730838581537.png)<br />![1730838615899](image/README/1730838615899.png)<br />![1730838660341](image/README/1730838660341.png)                                                                                                         |
|                                                                                              5. Сгенерировать документацию к модулю<br />с помощью terraform-docs                                                                                              | terraform-docs установлен локально.<br />Сформирована документация для<br />локального модуля vpc.                                                                                                                                                                                                         | ![1730839923760](image/README/1730839923760.png)<br />![1730839950469](image/README/1730839950469.png)                                                                                                                                                             |

## Задание 3

|                                                                       Номер и описание задачи                                                                       | Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                                                           | Скриншоты                                                                                                                                     |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                      1. Вывести список всех<br />ресурсов в стейте                                                      | Использована команда<br />terraform state list                                                                                                                                                                                                                                                                                                                                                                                                                  | ![1730840273421](image/README/1730840273421.png)                                                                                                         |
|                                                      2. Полностью удалить из<br />стейта модуль vpc                                                      | terraform state rm не поддерживает<br />использование символов подстановки,<br />таких как '*'.<br />Поэтому удалять все ресурсы модуля<br />vpc придется поочереди.                                                                                                                                                                                                          | ![1730840597379](image/README/1730840597379.png)                                                                                                         |
|                                                      3. Полностью удалить из<br />стейста модуль vm                                                      | По аналогии с удалением ресурсов vpc,<br />удалил поочереди ресурсы модулей ВМ.<br /><br />P.S. в последствии выяснил, что для удаления<br />всех ресурсов модуля, можно не удалять их<br />по очереди, а выполнить команду удаления из<br />стейта по имени модуля (на скриншоте) | ![1730840697094](image/README/1730840697094.png)                                                                                                         |
| 4. Импортировать удаленные<br />ресурсы обратно.<br />Проверить plan. Значимых<br />изменений быть не должно. | Импортировал ресурсы.<br />Идентификаторы брал из консоли YC.<br />Можно было, в теории, в бэкапе стейта их<br />подглядеть.<br /><br />Проверил plan. Значимых изменений<br />не обнаружил.                                                                                                                                                            | ![1730840979697](image/README/1730840979697.png)<br />![1730841234224](image/README/1730841234224.png)<br />![1730841354463](image/README/1730841354463.png) |
