# Домашнее задание к занятию "Gitlab"

## Подготовка к выполнению

|                                                                              Номер и описание задачи                                                                              | Описание выполняемых действий                                                                                                                    | Скриншоты                                                                                                                                     |
| :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                             1. Развернуть YC в Gitlab.<br />Либо managed либо на отдельной ВМ<br />из публичного образа.                             | Для развертывания выбрал отдельную<br />ВМ и публичный образ.                                                               | ![1736239017012](image/README/1736239017012.png)<br />![1736239294014](image/README/1736239294014.png)<br />![1736239723079](image/README/1736239723079.png) |
|                2. Создать виртуальную машину и<br />установить на нее gitlab runner.<br />Подключить runner к серверу Gitlab.                | Создал отдельную ВМ для раннера.<br />Установил раннер по инструкции.<br />Подключил раннер к Gitlab. | ![1736239256461](image/README/1736239256461.png)<br />![1736239474926](image/README/1736239474926.png)<br />![1736240456872](image/README/1736240456872.png) |
|                                                                               3. Создать новый проект.                                                                               | Создал новый проект                                                                                                                                        | ![1736240663040](image/README/1736240663040.png)                                                                                                         |
| 4. Создать новый репозиторий в Gitlab.<br />Наполнить его [файлами](https://github.com/netology-code/mnt-homeworks/tree/MNT-video/09-ci-06-gitlab/repository) | Добавил в реп файл python-api.py                                                                                                                             | ![1736241112295](image/README/1736241112295.png)<br />![1736241120959](image/README/1736241120959.png)                                                     |
|                                       5. Проект должен быть публичным.<br />Остальные настройки по желанию.                                       | Проект создан публичным.                                                                                                                               |                                                                                                                                                        |

## Основная часть

### DevOps

| Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Скриншоты                                                                                                                                                                                                                                                                                                 |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. По документации gitlab включил доступ к container registry (по умолчанию он отключен в образе YC)                                                                                                                                                                                                                                                                                                                                                               | ![1736256856786](image/README/1736256856786.png)                                                                                                                                                                                                                                                                     |
| 2. Т.к. регистри у меня работает на http, то от использования dind решил отказаться и использовать<br />shell в качестве executor.<br />Дополнительно настроил раннер:<br />- Установил docker<br />- Добавил пользователя раннера в группу docker<br />- Настроил docker на раннере на работу с "незащищенным" регистри |                                                                                                                                                                                                                                                                                                                    |
| 3. В репозиторий добавил:<br />- Файл зависимостей requirements.txt<br />- Dockerfile                                                                                                                                                                                                                                                                                                                                                                                                   | ![1736267900811](image/README/1736267900811.png)<br />![1736267915294](image/README/1736267915294.png)                                                                                                                                                                                                                 |
| 4. Добавил файл .gitlab-ci.yml с описанием пайплайна.                                                                                                                                                                                                                                                                                                                                                                                                                                        | ![1736267952336](image/README/1736267952336.png)                                                                                                                                                                                                                                                                     |
| 5. Проверил выполнение пайплайна - все выполняется корректно.<br />При комите в любую ветку должен собираться docker image с форматом имени <br />restfull-api:gitlab-$CI_COMMIT_SHORT_SHA . Образ пушится в мой Gitlab registry                                                                                                                                                                       | ![1736268114406](image/README/1736268114406.png)<br />![1736269807978](image/README/1736269807978.png)<br />![1736269829471](image/README/1736269829471.png)<br />![1736269966190](image/README/1736269966190.png)<br />![1736269978751](image/README/1736269978751.png)<br />![1736270003405](image/README/1736270003405.png) |

### Product Owner

| Описание выполняемых действий                                                                    | Скриншоты                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| 1. Создал дополнительных пользователей<br />- Product Owner<br />- Developer<br />- Tester | ![1736268800254](image/README/1736268800254.png)                                                     |
| 2. Добавил этих пользователей в проект                                                       | ![1736269004838](image/README/1736269004838.png)                                                     |
| 3. Зашел под пользователем Product Owner                                                               | ![1736269085729](image/README/1736269085729.png)                                                     |
| 4. Создал новый issue согласно задаче                                                              | ![1736269692551](image/README/1736269692551.png)<br />![1736269726180](image/README/1736269726180.png) |

### Developer

| Описание выполняемых действий                                                                                                                                                                                                                                                                                                                                                                                          | Скриншоты                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Зашел в Gitlab под УЗ Developer                                                                                                                                                                                                                                                                                                                                                                                                     | ![1736270132592](image/README/1736270132592.png)                                                                                                         |
| 2. Создал новую ветку под решение созданной ранее задачи.                                                                                                                                                                                                                                                                                                                                           | ![1736270758786](image/README/1736270758786.png)                                                                                                         |
| 3. Внес изменения в код согласно задаче.<br />Закоммитил из в ветку.<br />Т.к. сборка и пуш в регистри должны проходить по всем<br />веткам (по всем коммитам), то проверил прошла ли сборка - <br />сборка завершилась успешно, образ появился в регистри. | ![1736270855759](image/README/1736270855759.png)<br />![1736270872315](image/README/1736270872315.png)<br />![1736270907098](image/README/1736270907098.png) |
| 4. Создал merge request. Адресовал его Продакту, а в качестве<br />ревьювера указал тестера.                                                                                                                                                                                                                                                                                            | ![1736271008395](image/README/1736271008395.png)<br />![1736271103515](image/README/1736271103515.png)<br />![1736271181218](image/README/1736271181218.png) |

### Tester

| Описание выполняемых действий                                                                                                                                   | Скриншоты                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Зашел в Gitlab под УЗ Tester                                                                                                                                                | ![1736271368817](image/README/1736271368817.png)                                                                                                         |
| 2. Открыл merge request                                                                                                                                                              | ![1736271408825](image/README/1736271408825.png)                                                                                                         |
| 3. Поднял докер-контейнер с образом из регистри и<br />проверил возврат метода на корректность.                  | ![1736271624557](image/README/1736271624557.png)<br />![1736271661583](image/README/1736271661583.png)                                                     |
| 4. Добавил комментарий в задачу, что имзменения<br />внесены корректно.                                                              | ![1736271867557](image/README/1736271867557.png)                                                                                                         |
| 5. Переключился на PO и слил изменения.<br />После слития изменений также закрылась и связанная<br />задача. | ![1736272052223](image/README/1736272052223.png)<br />![1736272090522](image/README/1736272090522.png)<br />![1736272141447](image/README/1736272141447.png) |

Dockerfile и файл пайплайна приложил в папку src рядом с данным README.
